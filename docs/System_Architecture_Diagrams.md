# FloatChat - System Architecture Diagrams

## Document Information
- **Project**: FloatChat - AI-Powered Conversational Interface for ARGO Ocean Data Discovery
- **Version**: 1.0
- **Date**: September 2024

## 1. RAG System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    RAG System Architecture                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   User      │    │   Streamlit │    │   FastAPI   │        │
│  │ Interface   │◄──►│   Frontend  │◄──►│   Backend   │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                │               │
│                                ▼                ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Chat      │    │   RAG       │    │   Vector    │        │
│  │ Interface   │    │ Pipeline    │    │ Database    │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│         │                │                │                    │
│         ▼                ▼                ▼                    │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Dashboard │    │   LangChain │    │   ChromaDB  │        │
│  │   Views     │    │   Framework │    │   Collection │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                │               │
│                                ▼                ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Plotly    │    │   LLM       │    │   Metadata  │        │
│  │   Charts    │    │ Services    │    │   Embeddings│        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                                │
│                                ▼                                │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Folium    │    │   OpenRouter│    │   Sentence   │        │
│  │   Maps      │    │   DeepSeek  │    │ Transformers│        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

## 2. MCP System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    MCP System Architecture                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   User      │    │   Streamlit │    │   MCP       │        │
│  │ Interface   │◄──►│   Frontend  │◄──►│   Client    │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                │               │
│                                ▼                ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Chat      │    │   MCP       │    │   Tool      │        │
│  │ Interface   │    │ Server      │    │ Registry    │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│         │                │                │                    │
│         ▼                ▼                ▼                    │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Dashboard │    │   Context   │    │   ARGO      │        │
│  │   Views     │    │ Manager     │    │ Tools       │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                │               │
│                                ▼                ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Plotly    │    │   Resource  │    │   Database  │        │
│  │   Charts    │    │ Manager     │    │ Query Tool  │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                │               │
│                                ▼                ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Folium    │    │   Session   │    │   Metadata  │        │
│  │   Maps      │    │ Management  │    │ Tool        │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                │               │
│                                ▼                ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Export    │    │   Tool      │    │   Geographic│        │
│  │   Features  │    │ Execution   │    │ Search Tool │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

## 3. Data Flow Diagram - RAG Approach

```
┌─────────────────────────────────────────────────────────────────┐
│                    RAG Data Flow Process                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User Query: "Show me salinity profiles near the equator"      │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐                                               │
│  │   Streamlit │                                               │
│  │   Frontend  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    HTTP POST /chat                            │
│  │   FastAPI   │◄───────────────────────────────────────────────┤
│  │   Backend   │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐                                               │
│  │   RAG       │                                               │
│  │ Pipeline    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Vector Search Query                        │
│  │   ChromaDB  │◄───────────────────────────────────────────────┤
│  │ Collection  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Retrieved Context                          │
│  │   Context   │◄───────────────────────────────────────────────┤
│  │ Retrieval   │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Context + Query                            │
│  │   LLM       │◄───────────────────────────────────────────────┤
│  │ Processing  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Generated Response                         │
│  │   Response  │◄───────────────────────────────────────────────┤
│  │ Generation  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    SQL Query Extraction                       │
│  │   SQL       │◄───────────────────────────────────────────────┤
│  │ Extraction  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Final Response                             │
│  │   User      │◄───────────────────────────────────────────────┤
│  │ Interface   │                                               │
│  └─────────────┘                                               │
└─────────────────────────────────────────────────────────────────┘
```

## 4. Data Flow Diagram - MCP Approach

```
┌─────────────────────────────────────────────────────────────────┐
│                    MCP Data Flow Process                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User Query: "Show me salinity profiles near the equator"      │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐                                               │
│  │   Streamlit │                                               │
│  │   Frontend  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    WebSocket Connection                       │
│  │   MCP       │◄───────────────────────────────────────────────┤
│  │   Client    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Query Analysis                             │
│  │   Tool      │◄───────────────────────────────────────────────┤
│  │ Selection   │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Tool Call Message                         │
│  │   MCP       │◄───────────────────────────────────────────────┤
│  │   Server    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Tool Execution                             │
│  │   Tool      │◄───────────────────────────────────────────────┤
│  │ Registry    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Database Query                             │
│  │   ARGO      │◄───────────────────────────────────────────────┤
│  │ Query Tool  │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    SQL Execution                              │
│  │ PostgreSQL  │◄───────────────────────────────────────────────┤
│  │ Database    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Query Results                              │
│  │   Tool      │◄───────────────────────────────────────────────┤
│  │ Response    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Response Assembly                          │
│  │   Response  │◄───────────────────────────────────────────────┤
│  │ Assembly    │                                               │
│  └─────────────┘                                               │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────┐    Final Response                             │
│  │   User      │◄───────────────────────────────────────────────┤
│  │ Interface   │                                               │
│  └─────────────┘                                               │
└─────────────────────────────────────────────────────────────────┘
```

## 5. Component Interaction Sequence - RAG

```
┌─────────────────────────────────────────────────────────────────┐
│                RAG Component Interaction Sequence               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User ──► Frontend ──► API ──► RAG Pipeline ──► ChromaDB     │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Vector Search         │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Context Retrieval    │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         LLM Processing       │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Response Generation   │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         SQL Extraction       │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Final Response       │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         API Response         │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Frontend Display     │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         User Interface       │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         User Sees Response   │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Dashboard Access     │
│   │         │         │         │               │               │
│   │         │         │         │               ▼               │
│   │         │         │         │         Visualization        │
└─────────────────────────────────────────────────────────────────┘
```

## 6. Component Interaction Sequence - MCP

```
┌─────────────────────────────────────────────────────────────────┐
│                MCP Component Interaction Sequence               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User ──► Frontend ──► MCP Client ──► MCP Server ──► Tool     │
│   │         │         │              │              Registry   │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Tool Selection  │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Tool Execution  │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Database Query │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         PostgreSQL     │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Query Results   │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Tool Response   │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Context Update  │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Response Assembly│
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         MCP Response    │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Client Processing│
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Frontend Update│
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         User Interface  │
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         User Sees Response│
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Additional Tools│
│   │         │         │              │              │          │
│   │         │         │              │              ▼          │
│   │         │         │              │         Visualization  │
└─────────────────────────────────────────────────────────────────┘
```

## 7. Database Schema Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    Database Schema Overview                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   ARGO_FLOATS                           │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ platform_number (PK) VARCHAR(20)                       │   │
│  │ latitude_min DECIMAL(10,6)                              │   │
│  │ latitude_max DECIMAL(10,6)                              │   │
│  │ longitude_min DECIMAL(10,6)                             │   │
│  │ longitude_max DECIMAL(10,6)                             │   │
│  │ time_min TIMESTAMP                                      │   │
│  │ time_max TIMESTAMP                                      │   │
│  │ region VARCHAR(50)                                      │   │
│  │ status VARCHAR(20)                                      │   │
│  │ created_at TIMESTAMP                                    │   │
│  │ updated_at TIMESTAMP                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                │ 1:N                          │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   ARGO_PROFILES                         │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ id (PK) SERIAL                                          │   │
│  │ platform_number (FK) VARCHAR(20)                       │   │
│  │ cycle_number INTEGER                                    │   │
│  │ pressure DECIMAL(10,2)                                  │   │
│  │ temperature DECIMAL(10,4)                               │   │
│  │ salinity DECIMAL(10,4)                                  │   │
│  │ time TIMESTAMP                                          │   │
│  │ latitude DECIMAL(10,6)                                  │   │
│  │ longitude DECIMAL(10,6)                                 │   │
│  │ data_mode VARCHAR(10)                                   │   │
│  │ quality_control JSONB                                   │   │
│  │ created_at TIMESTAMP                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                TOOL_EXECUTIONS                          │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ id (PK) SERIAL                                          │   │
│  │ session_id VARCHAR(100)                                 │   │
│  │ tool_name VARCHAR(100)                                  │   │
│  │ parameters JSONB                                        │   │
│  │ result JSONB                                            │   │
│  │ execution_time_ms INTEGER                               │   │
│  │ success BOOLEAN                                          │   │
│  │ error_message TEXT                                      │   │
│  │ created_at TIMESTAMP                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                CONTEXT_SESSIONS                         │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ session_id (PK) VARCHAR(100)                            │   │
│  │ user_id VARCHAR(100)                                    │   │
│  │ context_data JSONB                                      │   │
│  │ created_at TIMESTAMP                                    │   │
│  │ updated_at TIMESTAMP                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 8. Deployment Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    Deployment Architecture                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Load Balancer                        │   │
│  │                  (Nginx/HAProxy)                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Application Layer                     │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   Frontend  │  │   API       │  │   MCP       │    │   │
│  │  │   (Streamlit)│  │   (FastAPI) │  │   Server    │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Data Layer                           │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   Vector   │  │   Relational│  │   File      │    │   │
│  │  │   DB       │  │   Database  │  │   Storage   │    │   │
│  │  │ (ChromaDB) │  │ (PostgreSQL)│  │ (Parquet)   │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    External Services                    │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   ARGO     │  │   LLM       │  │   Monitoring│    │   │
│  │  │   Data     │  │   Services  │  │   (Prometheus)│    │   │
│  │  │   (Argopy) │  │ (OpenRouter)│  │             │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 9. Security Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    Security Architecture                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Security Layers                      │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   Network   │  │   Application│  │   Data      │    │   │
│  │  │   Security  │  │   Security   │  │   Security  │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Security Components                  │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   TLS      │  │   API       │  │   SQL       │    │   │
│  │  │   Encryption│  │   Keys      │  │   Validation│    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   Rate     │  │   Input     │  │   Audit     │    │   │
│  │  │   Limiting │  │   Validation│  │   Logging   │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 10. Monitoring and Observability Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                Monitoring and Observability                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Application Metrics                  │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   Query    │  │   Response  │  │   Error     │    │   │
│  │  │   Count    │  │   Time      │  │   Rate      │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Infrastructure Metrics               │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   CPU      │  │   Memory    │  │   Disk      │    │   │
│  │  │   Usage    │  │   Usage     │  │   Usage     │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Business Metrics                      │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   User     │  │   Query     │  │   Data      │    │   │
│  │  │   Activity │  │   Success   │  │   Coverage  │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Alerting System                      │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │   │
│  │  │   Prometheus│  │   Grafana   │  │   Alert    │    │   │
│  │  │   Metrics  │  │   Dashboard │  │   Manager   │    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

